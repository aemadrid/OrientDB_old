---
title: Multi Threading
layout: default
---

 <h2>
<a name="Introduction"></a>Introduction<a href="#Introduction" class="section_anchor"></a>
</h2>
<p>OrientDB supports multi-threads access to the database. <tt>ODatabase*</tt> instances are not thread-safe, so you've to get <i>an instance per thread</i> and each database instance can be used <i>only in one thread per time</i>. </p>
<p>Multiple database instances points to the same storage by using the same URL. In this case Storage is thread-save and orchestrates requests from different <tt>ODatabase*</tt> instances. </p>
<pre class="prettyprint">ODatabaseDocument1------+
                        +----&gt; OStorageLocal (url=local:/temp/db)
ODatabaseDocument2------+</pre>
<p>Database instances share the following objects: </p>
<ul>
<li>schema </li>
<li>index manager </li>
<li>security </li>
</ul><p>These objects are synchronized for concurrent contexts by storing the current database in the <a href="http://download.oracle.com/javase/6/docs/api/java/lang/ThreadLocal.html" rel="nofollow">ThreadLocal</a> variable. Every time you create, open or acquire a database connection, the database instance is <strong>automatically</strong> set into the current <a href="http://download.oracle.com/javase/6/docs/api/java/lang/ThreadLocal.html" rel="nofollow">ThreadLocal</a> space, so in normal use this is hidden from the developer. </p>
<p>The current database is always reset for all common operations like load, save, etc. </p>
<p>Example of using two database in the same thread: </p>
<pre class="prettyprint">ODocument rec1 = database1.newInstance();
ODocument rec2 = database2.newInstance();

rec1.field("name", "Luca");
database1.save(rec1); // force saving in database1 no matter where the record came from

rec2.field("name", "Luke");
database2.save(rec2); // force saving in database2 no matter where the record came from</pre>
<h2>
<a name="Manual_control"></a>Manual control<a href="#Manual_control" class="section_anchor"></a>
</h2>
<p>Beware when you reuse database instances from different threads or then a thread handle multiple databases. In this case you can override the current database by calling this manually: </p>
<pre class="prettyprint">ODatabaseRecordThreadLocal.INSTANCE.set( database );</pre>
<p>Where database is the current database instance. Example: </p>
<pre class="prettyprint">ODocument rec1 = database1.newInstance();
ODocument rec2 = database2.newInstance();

ODatabaseRecordThreadLocal.INSTANCE.set( database1 );
rec1.field("name", "Luca");
rec1.save();

ODatabaseRecordThreadLocal.INSTANCE.set( database2 );
rec2.field("name", "Luke");
rec2.save();</pre>
